<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />

<meta name="author" content="Cai Wu" />
    
<title>æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆäºŒï¼‰ | Blog</title>

 
<link rel="icon" href="/favicon.ico" />
  
<!-- stylesheets list from _config.yml -->

<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.1/viewer.min.css" />
   
<!-- scripts list from _config.yml -->

<script src="/js/jquery.js"></script>

<script src="/js/script.js"></script>

<script src="/js/tocbot.min.js"></script>

<script src="/js/search.js"></script>

<script src="/js/vanline.js"></script>

<script src="/js/viewer.js"></script>
   
    

<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">caiwu&#39;s Blog</a>
        <input type="text" id="local-search-input" placeholder="ğŸ”" />
      </div>
      <div id="local-search-result"></div>
      <div class="menu navbar-right">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/categories">Categories</a>
        
        <a class="menu-item" href="/tags">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">caiwu&#39;s Blog</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>
        <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
      </div>
      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/categories">Categories</a>
        
        <a class="menu-item" href="/tags">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName('menu-toggle')[0]
    var mobileMenu = document.getElementById('mobile-menu')
    if (toggleMenu.classList.contains('active')) {
      toggleMenu.classList.remove('active')
      mobileMenu.classList.remove('active')
    } else {
      toggleMenu.classList.add('active')
      mobileMenu.classList.add('active')
    }
  }
</script>

        <div class="main">
            <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>  
  <article class="post-wrap" id="artcle-container">
    <header class="post-header">
      <h1 class="post-title">
        æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆäºŒï¼‰
        <!-- id å°†ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ -->
        <span
          style="float: right; font-size: 12px; opacity: 0.6"
          id="/posts/4563e85b.html"
          class="leancloud_visitors"
          data-flag-title="æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆäºŒï¼‰"
        >
          <em class="post-meta-item-text">é˜…è¯»é‡ </em>
          <i class="leancloud-visitors-count"></i>
        </span>
      </h1>
      
      <div class="post-meta">
         Author:
        <a itemprop="author" rel="author" href="/"> Cai Wu </a>
        
        <!--  -->
        
        <span class="post-time">
          &nbsp Date:
          <a href="#">
            ä¸‰æœˆ 23, 2022&nbsp;&nbsp;16:13:24
          </a>
        </span>
        
        <!--  -->
        <!--  -->
        
        <span class="post-time">
          &nbsp Update:
          <a href="#">
            å…­æœˆ 4, 2022&nbsp;&nbsp;4:44:31
          </a>
        </span>
        
        <!--  -->
        
      </div>
      
    </header>

    <div class="post-content"><h2 id="å…‰æ ‡"><a href="#å…‰æ ‡" class="headerlink" title="å…‰æ ‡"></a>å…‰æ ‡</h2><p>ä¸Šä¸€ç« ä»‹ç»å¯Œæ–‡æœ¬çš„å‘å±•å†ç¨‹ï¼Œç« ä¸»è¦ä»‹ç»L2æ¶æ„ä¸­å…‰æ ‡çš„å®ç°ï¼›é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œç”±äºL2çº§åˆ«å·²ç»å®Œå…¨æŠ›å¼ƒäº†<code>contenteditable</code>ï¼Œæ„å‘³ç€éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ä¸€ä¸ªç±»ä¼¼çš„åŠŸèƒ½ï¼Œå³æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªdivçš„å†…å®¹ï¼Œè¦å‡ºç°å…‰æ ‡å’Œå¯ç¼–è¾‘ã€‚å¯ç¼–è¾‘ä¹‹åå†è®²ï¼Œç°åœ¨æˆ‘ä»¬å°†è§è§£å…‰æ ‡çš„å®ç°æ€è·¯ã€‚</p>
<h3 id="ä½ç½®"><a href="#ä½ç½®" class="headerlink" title="ä½ç½®"></a>ä½ç½®</h3><p>æŸ¥é˜…W3Cè§„èŒƒæˆ‘ä»¬å‘ç°å…¶å®æµè§ˆå™¨å¹¶æ²¡æœ‰ä¸€ä¸ªç°æˆçš„APIæ¥è·å–å…‰æ ‡çš„å…·ä½“åæ ‡ï¼›ä½†æ˜¯å¯ä»¥è·å–clickäº‹ä»¶çš„åæ ‡ï¼Œèƒ½ä¸èƒ½ç”¨è¯¥åæ ‡æ¥ç¡®å®šå…‰æ ‡å…·ä½“çš„ä½ç½®å‘¢ï¼Œç†è®ºä¸Šæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ååˆ†éº»çƒ¦ï¼Œå› ä¸ºå…‰æ ‡å¿…é¡»å’Œå­—å¯¹é½ï¼Œè€Œä¸èƒ½åœ¨å­—çš„ä¸Šé¢ä¸‹é¢æˆ–è€…ä¸­é—´ï¼Œè¿™å°±éœ€è¦ä¸€å¥—å°±è¿‘å¸é™„ç®—æ³•ï¼Œå³è®¡ç®—å‡ºç‚¹å‡»å‡ºä½œä¸ºæ‰€æœ‰çš„å¯æ’å…¥ä½ç‚¹ï¼Œè®¡ç®—ç‚¹å‡»åæ ‡ç¦»è°æœ€è¿‘ã€‚è¿˜æœ‰æ²¡æœ‰æ›´ç®€å•çš„æ–¹æ³•å‘¢ï¼Œæœ‰ï¼Œè™½ç„¶æˆ‘ä»¬ä¸ä¾èµ–æµè§ˆå™¨çš„é€‰åŒºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å®ƒæ¥è®¡ç®—ç‚¹å‡»åç§»é‡ã€‚</p>
<h3 id="åç§»é‡"><a href="#åç§»é‡" class="headerlink" title="åç§»é‡"></a>åç§»é‡</h3><p>ä»€ä¹ˆæ˜¯åç§»é‡å‘¢ï¼Œæ‰€è°“åç§»é‡ï¼Œå°±æ˜¯æµè§ˆå™¨å¯¹å…‰æ ‡ä½ç½®çš„ä¸€ç§æè¿°ï¼Œå³rangeã€‚è™½ç„¶æˆ‘ä»¬æ²¡æœ‰ç»™domåŠ ä¸Šcontenteditableå±æ€§ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ç‚¹å‡»é¡µé¢çš„æ—¶å€™ï¼Œå¯ä»¥è·å–åˆ°rangeã€‚é€šè¿‡è¿™ä¸ªrangeæˆ‘ä»¬å¯ä»¥è·å–åˆ°çš„ä¿¡æ¯æ˜¯å“ªä¸ªdomï¼Œåç§»äº†å‡ ä¸ªæ–‡å­—æˆ–è€…èŠ‚ç‚¹ï¼Œå¯¹äº selection å’Œ  range ä¸ç†Ÿæ‚‰çš„å¯å‚è€ƒ <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range">MDN</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–selectionå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line"><span class="comment">// è·å–rangeæ•°é‡ï¼Œæ³¨æ„chromeåªæ”¯æŒå•é€‰åŒºï¼Œç«ç‹å¯æ”¯æŒå¤šä¸ª</span></span><br><span class="line"><span class="keyword">const</span> rangeCount = selection.rangeCount</span><br><span class="line"><span class="comment">// è·å–rangeï¼Œåªè¦ç‚¹å‡»äº†é¡µé¢å°±èƒ½è·å–åˆ°rangeï¼Œä½ç‚¹å‡»æˆ–è€…é¡µé¢å¤±ç„¦åˆ™ rangeCount ä¸º 0</span></span><br><span class="line"><span class="keyword">let</span> range</span><br><span class="line"><span class="keyword">if</span>(rangeCount&gt;<span class="number">0</span>)&#123;</span><br><span class="line">  range  = selection.getRangeAt(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://fastly.jsdelivr.net/gh/caiwuu/image/image-20220323165306273.png" alt="image-20220323165306273"></p>
<p>ç”±ä¸Šå›¾å¯çŸ¥ä¸€ä¸ªrangeåŒ…å«äº†è¿™äº›ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬é€‰ä¸­ä¸€æ®µå†…å®¹æ—¶,<code>starContainer</code>å’Œ<code>startOffset</code>æè¿°äº†å·¦è¾¹ç•Œæ‰€åœ¨çš„domå’Œåç§»é‡ï¼Œ<strong>æ³¨æ„ï¼Œå¦‚æœstarContaineræ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£è¿™ä¸ªåç§»é‡å°±æ˜¯åç§»å‡ ä¸ªæ–‡å­—ï¼›å¦‚æœæ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™è¡¨ç¤ºåç§»å‡ ä¸ªå­èŠ‚ç‚¹</strong>ï¼ŒåŒç†ï¼Œ<code>endContainer</code>å’Œ<code>endOffset </code>æè¿°äº†å³è¾¹ç•Œæ‰€åœ¨çš„domå’Œåç§»é‡ã€‚å½“åªæ˜¯ç‚¹å‡»è€Œä¸æ˜¯é€‰ä¸­å†…å®¹æ—¶ï¼Œæ­¤æ—¶çš„<code>starContainer</code>å’Œ<code>endContainer</code>,<code>startOffset</code>å’Œ<code>endOffset</code>ç›¸ç­‰</p>
<h3 id="åæ ‡è®¡ç®—"><a href="#åæ ‡è®¡ç®—" class="headerlink" title="åæ ‡è®¡ç®—"></a>åæ ‡è®¡ç®—</h3><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•è·å–ç‚¹å‡»ç„¦ç‚¹çš„åç§»é‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¦‚æœè¦è‡ªç»˜å…‰æ ‡ï¼Œè¿™è‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“å®ƒçš„å‡†ç¡®xyåæ ‡ã€‚ç›¸ä¿¡èªæ˜çš„ä½ å·²ç»æƒ³åˆ°äº†ï¼Œç©ºæ ‡ç­¾ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦è®¡ç®—ä½ç½®çš„åœ°æ–¹æ’å…¥ä¸€ä¸ªç©ºæ ‡ç­¾ï¼Œæ‹¿åˆ°ç©ºæ ‡ç­¾åæ ‡ä¹‹åå†åˆ é™¤</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dom = <span class="built_in">document</span>.createElement(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> temp = endContainer.splitText(endOffset)</span><br><span class="line">endContainer.parentNode.insertBefore(dom, temp)</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">offsetLeft</span>: x, <span class="attr">offsetTop</span>: y, offsetHeight&#125; = dom</span><br><span class="line">dom.remove()</span><br><span class="line">endContainer.data = endContainer.data + temp.data</span><br><span class="line">temp.remove()</span><br></pre></td></tr></table></figure>

<h3 id="å…‰æ ‡ç»˜åˆ¶"><a href="#å…‰æ ‡ç»˜åˆ¶" class="headerlink" title="å…‰æ ‡ç»˜åˆ¶"></a>å…‰æ ‡ç»˜åˆ¶</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æ‹¿åˆ°äº†å‡†ç¡®çš„åæ ‡ä¿¡æ¯äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è‡ªå·±ç»˜åˆ¶ä¸€ä¸ªå…‰æ ‡äº†ï¼Œå¦‚ç»˜åˆ¶ä¸€ä¸ªç»å¯¹å®šä½çš„spanæ ‡ç­¾ï¼Œç„¶åè®¾ç½®ä¸€ä¸ªcssé—ªçƒçš„åŠ¨ç”»å³å¯ï¼Œç»˜åˆ¶å…‰æ ‡æ¯”è¾ƒåŸºç¡€å…·ä½“ä»£ç å°±ä¸å†™äº†ï¼ŒcssåŠ¨ç”»ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.custom-caret</span> &#123;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">pointer-events</span>: none;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">animation</span>: caret <span class="number">1s</span> infinite <span class="number">0.5s</span> <span class="built_in">steps</span>(<span class="number">1</span>, start);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> caret &#123;</span><br><span class="line">    <span class="number">0%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">50%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>Author:</span>
        <span> Cai Wu </span>
      </p>
       
      <p class="copyright-item" style="text-overflow: ellipsis; overflow: hidden">
        <span>Permalink:</span>
        <span><a href="https://caiwuu.github.io/posts/4563e85b.html"> https://caiwuu.github.io/posts/4563e85b.html </a></span>
      </p>
        
    </section>
    
    <section class="post-tags">
      <div>
        <span>Tag(s):</span>
        <span class="tag">
          
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">back</a>
        <span>Â· </span>
        <a href="/">home</a>
      </div>
    </section>
    <section class="post-nav" style="height: 72px">
      
      <a class="prev" rel="next" href="/posts/45bb21ba.html"> æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆä¸€ï¼‰ </a>
       
      <a class="next" rel="prev" href="/posts/c753095b.html"> æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆä¸‰ï¼‰ </a>
      
    </section>
    <div id="vcomments"></div>
    <!-- id å°†ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ -->
    <script>
      const viewer = new Viewer(document.getElementById('artcle-container'), {
        inline: false,
        // viewed() {
        //   // viewer.zoomTo(0.8)
        // },
      })
      new Valine({
        el: '#vcomments',
        appId: 'WMcVmY3mpwsbkLkKENagoOts-gzGzoHsz',
        appKey: 'eE10SdKfvwoU6o1FKHRS3JuF',
        meta: ['nick'],
        avatar: 'robohash',
        visitor: true, // é˜…è¯»é‡ç»Ÿè®¡
        recordIP: true,
      })
    </script>
  </article>
</div>

        </div>
        <footer id="footer" class="footer">
  <div class="copyright">
    <span>Â© Cai Wu | 2020</span>
  </div>
</footer>

    </div>
</body>
</html>
