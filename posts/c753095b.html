<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />

<meta name="author" content="Cai Wu" />
    
<title>æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆä¸‰ï¼‰ | Blog</title>

 
<link rel="icon" href="/favicon.ico" />
  
<!-- stylesheets list from _config.yml -->

<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.1/viewer.min.css" />
   
<!-- scripts list from _config.yml -->

<script src="/js/jquery.js"></script>

<script src="/js/script.js"></script>

<script src="/js/tocbot.min.js"></script>

<script src="/js/search.js"></script>

<script src="/js/vanline.js"></script>

<script src="/js/viewer.js"></script>
   
    

<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">caiwu&#39;s Blog</a>
        <input type="text" id="local-search-input" placeholder="ğŸ”" />
      </div>
      <div id="local-search-result"></div>
      <div class="menu navbar-right">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/categories">Categories</a>
        
        <a class="menu-item" href="/tags">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">caiwu&#39;s Blog</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>
        <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
      </div>
      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">Posts</a>
        
        <a class="menu-item" href="/categories">Categories</a>
        
        <a class="menu-item" href="/tags">Tags</a>
        
        <a class="menu-item" href="/about">About</a>
        
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName('menu-toggle')[0]
    var mobileMenu = document.getElementById('mobile-menu')
    if (toggleMenu.classList.contains('active')) {
      toggleMenu.classList.remove('active')
      mobileMenu.classList.remove('active')
    } else {
      toggleMenu.classList.add('active')
      mobileMenu.classList.add('active')
    }
  }
</script>

        <div class="main">
            <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>  
  <article class="post-wrap" id="artcle-container">
    <header class="post-header">
      <h1 class="post-title">
        æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆä¸‰ï¼‰
        <!-- id å°†ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ -->
        <span
          style="float: right; font-size: 12px; opacity: 0.6"
          id="/posts/c753095b.html"
          class="leancloud_visitors"
          data-flag-title="æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆä¸‰ï¼‰"
        >
          <em class="post-meta-item-text">é˜…è¯»é‡ </em>
          <i class="leancloud-visitors-count"></i>
        </span>
      </h1>
      
      <div class="post-meta">
         Author:
        <a itemprop="author" rel="author" href="/"> Cai Wu </a>
        
        <!--  -->
        
        <span class="post-time">
          &nbsp Date:
          <a href="#">
            ä¸‰æœˆ 25, 2022&nbsp;&nbsp;16:36:40
          </a>
        </span>
        
        <!--  -->
        <!--  -->
        
        <span class="post-time">
          &nbsp Update:
          <a href="#">
            å…­æœˆ 4, 2022&nbsp;&nbsp;4:44:31
          </a>
        </span>
        
        <!--  -->
        
      </div>
      
    </header>

    <div class="post-content"><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><p>ä¸Šä¸€ç« ä»‹ç»äº†ä¸€ç§å…‰æ ‡çš„å®ç°æ€è·¯ï¼Œè¿™ä¸€ç« ä»‹ç»å¯Œæ–‡æœ¬ç¼–è¾‘çš„ä¸€å¤§æ ¸å¿ƒå†…å®¹ï¼Œæ¨¡å‹è®¾è®¡ã€‚ä»€ä¹ˆæ˜¯æ¨¡å‹ï¼ˆmodelï¼‰ï¼Œæ¨¡å‹å°±æ˜¯å¯¹è§†å›¾çš„ä¸€ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå®ƒèƒ½å¤Ÿå’Œè§†å›¾ç›´æ¥çš„æˆ–è€…é—´æ¥çš„å½¢æˆæ˜ å°„ã€‚å‰é¢ä»‹ç»è¿‡çš„L0é˜¶æ®µçš„ç¼–è¾‘å™¨å¤§å¤šæ•°éƒ½æ˜¯æ²¡æœ‰modelçš„ï¼Œå®ƒä»¬é‡‡ç”¨çš„æ˜¯ç›´æ¥æ“ä½œdomçš„æ–¹å¼ã€‚ç›´æ¥æ“ä½œdomçš„ä¼˜ç‚¹æ˜¯å®ç°ç®€å•ï¼Œä½†æ˜¯ä¸æ–¹ä¾¿åšæ ‡è®°ï¼Œä¸æ–¹ä¾¿diffï¼Œä¸€ä¸å°å¿ƒè¿˜ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚</p>
<h3 id="ä¸€æ®µå¯Œæ–‡æœ¬åŒ…å«ä»€ä¹ˆä¿¡æ¯"><a href="#ä¸€æ®µå¯Œæ–‡æœ¬åŒ…å«ä»€ä¹ˆä¿¡æ¯" class="headerlink" title="ä¸€æ®µå¯Œæ–‡æœ¬åŒ…å«ä»€ä¹ˆä¿¡æ¯"></a>ä¸€æ®µå¯Œæ–‡æœ¬åŒ…å«ä»€ä¹ˆä¿¡æ¯</h3><p>æˆ‘ä»¬ä»â€ä¸€æ®µå¯Œæ–‡æœ¬åŒ…å«ä»€ä¹ˆä¿¡æ¯â€œè¿™ä¸ªé—®é¢˜æ¥æ¢ç©¶æ¨¡å‹çš„è®¾è®¡ï¼Œé€šå¸¸æ¥è¯´ï¼Œä¸€æ®µå¯Œæ–‡æœ¬æ— éå°±åŒ…å«äº†ç»“æ„ä¿¡æ¯ã€æ ·å¼ä¿¡æ¯ã€å†…å®¹ä¿¡æ¯ï¼Œç»“æ„ä¿¡æ¯æœ‰å¦‚æ®µè½ç»“æ„ï¼Œé€šå¸¸æ¥æè¿°å†…å®¹çš„ä½ç½®ä¿¡æ¯ï¼›æ ·å¼ä¿¡æ¯å¦‚å­—ä½“å¤§å°ï¼Œé¢œè‰²ï¼ŒåŠ ç²—ï¼Œå€¾æ–œç­‰ï¼Œå¯¹å†…å®¹å…¶ä¿®é¥°ä½œç”¨ï¼Œå†…å®¹ä¿¡æ¯å³æ–‡å­—å›¾ç‰‡è§†é¢‘ç­‰ä¿¡æ¯ã€‚åœ¨æˆ‘ä»¬æ“ä½œå¯Œæ–‡æœ¬çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ— éå°±æ˜¯æ”¹å˜è¿™ä¸‰ç§ä¿¡æ¯ã€‚å› æ­¤æ•°æ®æ¨¡å‹å¿…é¡»èƒ½æ¸…æ™°å‡†ç¡®çš„åæ˜ è¿™ä¸‰ç§ä¿¡æ¯ã€‚</p>
<h3 id="å¯Œæ–‡æœ¬çš„ä¸¤ç±»æ“ä½œ"><a href="#å¯Œæ–‡æœ¬çš„ä¸¤ç±»æ“ä½œ" class="headerlink" title="å¯Œæ–‡æœ¬çš„ä¸¤ç±»æ“ä½œ"></a>å¯Œæ–‡æœ¬çš„ä¸¤ç±»æ“ä½œ</h3><p>ä¸Šé¢è¯´äº†æ“ä½œå¯Œæ–‡æœ¬çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæ— éå°±æ˜¯æ”¹å˜è¿™ä¸‰ç§ä¿¡æ¯ï¼ˆå˜é‡ï¼‰ï¼Œä½†æ˜¯ä»–ä»¬çš„æ“ä½œæœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œè¿™é‡Œåˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»å•å˜é‡æ”¹å˜ï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥å®šä½åˆ°å…·ä½“çš„èŠ‚ç‚¹çš„æ“ä½œï¼Œå¦‚è¾“å…¥ä¸€ä¸ªæ–‡å­—ï¼Œæ’å…¥ä¸€ä¸ªå›¾ç‰‡ï¼Œæ’å…¥ä¸€ä¸ªæ®µè½ï¼Œè¿™äº›é€šè¿‡å…‰æ ‡ä½ç½®å¾ˆå®¹æ˜“çŸ¥é“åœ¨å“ªä¸ªèŠ‚ç‚¹åŠ å…¥äº†ä»€ä¹ˆå†…å®¹ï¼Œå› æ­¤ï¼Œè¿™ç±»æ“ä½œå¯ä»¥ç›´æ¥åœ¨<strong>æ“ä½œæµ®å±‚</strong>ä¸Šé¢æ“ä½œã€‚æ‰€è°“æ“ä½œæµ®å±‚ï¼Œå°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿdomï¼Œä¹Ÿæ˜¯å³å°†ä»‹ç»çš„ä¸€ä¸ªæ•°æ®æ¨¡å‹ï¼Œå’Œvueã€reactä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„vnodeä¸Šé¢ä»£ç†äº†ä¸€äº›domæ“ä½œï¼Œè¿™å°±ä½¿æˆ‘ä»¬åœ¨æ”¹å˜vnodeçš„åŒæ—¶å¯ä»¥åŒæ­¥çœŸå®domï¼Œæ— éœ€diffã€‚å¦ä¸€ç±»æ˜¯å¤šå˜é‡åŒæ—¶æ”¹å˜çš„æ“ä½œï¼Œå¦‚æ ·å¼çš„ä¿®æ”¹å°±å¯èƒ½æ¶‰åŠåˆ°ç»“æ„çš„å˜åŒ–,è¿™ç±»æ“ä½œåˆ™æ˜¯é€šè¿‡<strong>å†…å®¹æ ‡è®°æ¨¡å‹</strong>æ¥æ“ä½œã€‚ä¸‹é¢å°†åˆ†åˆ«å…·ä½“ä»‹ç»ä¸‹vnodeç»“æ„å’Œå†…å®¹æ ‡è®°æ¨¡å‹ï¼š</p>
<h3 id="è™šæ‹ŸDOM"><a href="#è™šæ‹ŸDOM" class="headerlink" title="è™šæ‹ŸDOM"></a>è™šæ‹ŸDOM</h3><ul>
<li>VNode èŠ‚ç‚¹åŸºç±» <a target="_blank" rel="noopener" href="https://github.com/caiwuu/editor-pro/blob/master/src/core/model/vnode.js">å…·ä½“ä»£ç æºç </a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VNode</span> </span>&#123;</span><br><span class="line">  _type = <span class="literal">null</span> <span class="comment">// èŠ‚ç‚¹ç±»å‹ æœ‰blockã€inlineã€textã€atomicï¼ˆåŸå­èŠ‚ç‚¹ï¼Œæ— å­èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">  editable = <span class="literal">null</span> <span class="comment">// å¯ç¼–è¾‘</span></span><br><span class="line">  key = <span class="literal">null</span> </span><br><span class="line">  ns = <span class="string">&#x27;&#x27;</span> <span class="comment">// å‘½åç©ºé—´</span></span><br><span class="line">  attrs = &#123;&#125; <span class="comment">// å±æ€§</span></span><br><span class="line">  position = <span class="string">&#x27;0&#x27;</span> <span class="comment">// ä»æ ¹è·¯å¾„åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„indexè¿æ¥æˆçš„å­—ç¬¦ä¸²</span></span><br><span class="line">  path = [] <span class="comment">// ä»æ ¹è·¯å¾„åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„</span></span><br><span class="line">  index = <span class="number">0</span> <span class="comment">// åœ¨çˆ¶çº§å­å…ƒç´ ä¸­çš„ç´¢å¼•</span></span><br><span class="line">  parentNode = <span class="literal">null</span> <span class="comment">// çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">  _isVnode = <span class="literal">true</span></span><br><span class="line">  elm = <span class="literal">null</span> <span class="comment">// çœŸå®dom</span></span><br><span class="line">  isRoot = <span class="literal">true</span> <span class="comment">// æ˜¯å¦æ ¹èŠ‚ç‚¹</span></span><br><span class="line">  tagName = <span class="literal">null</span> </span><br><span class="line">  _children = [] </span><br><span class="line">  styles = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  classes = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">  listeners = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// åˆ›å»ºdom</span></span><br><span class="line"> <span class="comment">// æ“ä½œä»£ç†æ–¹æ³•</span></span><br><span class="line">  <span class="function"><span class="title">insert</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// æ’å…¥</span></span><br><span class="line">  <span class="function"><span class="title">delete</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// åˆ é™¤</span></span><br><span class="line">  <span class="function"><span class="title">moveTo</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// ç§»å…¥</span></span><br><span class="line">  ....</span><br></pre></td></tr></table></figure>

<ul>
<li>elementVNode å…ƒç´ ç±»èŠ‚ç‚¹ï¼Œç»§æ‰¿äºVNode</li>
<li>textVNode æ–‡æœ¬ç±»èŠ‚ç‚¹ ï¼Œç»§æ‰¿äºVNode</li>
</ul>
<blockquote>
<p>vnodeæ˜¯ä¸€ä¸ªå’Œdomç»“æ„ä¸€ä¸€å¯¹åº”çš„æ ‘çŠ¶ç»“æ„ï¼Œè¿™ç§ç»“æ„å¾ˆå®¹æ˜“æè¿°ä¸€äº›å•ä¸€ä¿¡æ¯æ”¹å˜çš„æ“ä½œï¼Œå¦‚åœ¨æŸä¸ªä½ç½®æ’å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥å¯ä»¥æè¿°ä¸ºåœ¨positionä¸ºxxxçš„ï¼Œåç§»é‡offsetä¸ºxxçš„ä½ç½®ä¸Šæ’å…¥å­—ç¬¦xxã€‚å› æ­¤å½¢è±¡çš„å°†è¿™ç§ç»“æ„å«åšæ“ä½œæµ®å±‚ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤§é‡çš„èŠ‚ç‚¹æ›´æ–°ï¼Œå¾ˆéš¾åˆ†æå…·ä½“çš„æ“ä½œä½ç‚¹ï¼Œè¿™æ—¶å€™å°†é€šè¿‡diffç®—æ³•å»æ›´æ–°ã€‚<a target="_blank" rel="noopener" href="https://github.com/caiwuu/editor-pro/blob/master/src/core/model/patch.js">å…·ä½“å®ç°å¯çœ‹æºç </a></p>
</blockquote>
<p>è™½ç„¶æ ‘çŠ¶ç»“æ„èƒ½å¾ˆç›´è§‚çš„æè¿°ä¸‰ç±»ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿå’Œdomç»“æ„ä¸€è‡´ï¼Œæ›´åˆä¹æˆ‘ä»¬çš„æ€ç»´æ–¹å¼ï¼Œä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ç»™å†…å®¹åŠ æ ·å¼æ—¶ï¼Œå¯èƒ½æ¶‰åŠåˆ°æ ·å¼ä¿¡æ¯å’Œç»“æ„ä¿¡æ¯åŒæ—¶æ”¹å˜ï¼Œè¿™ç§æ“ä½œå¦‚æœåœ¨æ ‘å½¢ç»“æ„çš„vnodeä¸­å»åˆ†æå˜æ¢ä¸ä»…è¦è€ƒè™‘æ ‘å±‚çº§å˜åŒ–ï¼Œè¿˜è¦è€ƒè™‘å„ç§åµŒå¥—é—®é¢˜ï¼Œå›æº¯é—®é¢˜ï¼Œè¿™æ ·ä¸€æ¥é—®é¢˜çš„å¤æ‚åº¦æå…¶å¤æ‚ã€‚å¦‚ä¸‹é¢çš„ä¸€æ®µå†…å®¹ï¼š</p>
<p><img src="https://fastly.jsdelivr.net/gh/caiwuu/image/image-20220330095610967.png" alt="image-20220330095610967"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;editor-paragraph&quot;</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬1æ™®é€šæ–‡æœ¬2</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>åŠ ç²—æ–‡æœ¬<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">em</span>&gt;</span>æ–œä½“æ–‡æœ¬<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬4</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœå°†â€æ™®é€šæ–‡æœ¬2â€œå˜çº¢åŠ ç²—ï¼Œä¸€å¼€å§‹å¯èƒ½æˆ‘ä»¬ä¼šå°†ä»£ç å˜æˆä¸‹é¢è¿™æ ·</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;editor-paragraph&quot;</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬1</span><br><span class="line">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>æ™®é€šæ–‡æœ¬2<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>åŠ ç²—æ–‡æœ¬<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">em</span>&gt;</span>æ–œä½“æ–‡æœ¬<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬4</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œè¿™æ ·çš„ç»“æ„æ˜æ˜¾ä¸æ˜¯æœ€ä¼˜çš„ç»“æ„ï¼Œç®€å•çš„è§‚å¯Ÿå¯ä»¥å‘ç°å®ƒå’Œä¸‹ä¸€ä¸ªstrongæ ‡ç­¾å¯ä»¥åˆå¹¶ï¼Œå˜æˆä¸‹é¢è¿™æ ·</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;editor-paragraph&quot;</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬1</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>æ™®é€šæ–‡æœ¬2åŠ ç²—æ–‡æœ¬<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">em</span>&gt;</span>æ–œä½“æ–‡æœ¬<span class="tag">&lt;/<span class="name">em</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    æ™®é€šæ–‡æœ¬4</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ç§æ‰æ˜¯æœ€ä¼˜çš„ç»“æ„ï¼Œæˆ‘ä»¬åœ¨ä»£ç å±‚é¢ä¸Šæ¥åˆ†è§£ä¸‹å¤„ç†è¿‡ç¨‹ï¼š</p>
<ul>
<li><p>åˆ†å‰²æ–‡æœ¬èŠ‚ç‚¹ <code>&lt;text&gt;æ™®é€šæ–‡æœ¬1æ™®é€šæ–‡æœ¬2&lt;/text&gt;</code>ä¸º<code>&lt;text&gt;æ™®é€šæ–‡æœ¬1&lt;/text&gt;</code> <code>&lt;text&gt;æ™®é€šæ–‡æœ¬2&lt;/text&gt;</code></p>
</li>
<li><p>æ£€æµ‹ä¸‹ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æ˜¯ä¸æ˜¯çº¢è‰²ï¼Œæœ‰æ²¡æœ‰strongèŠ‚ç‚¹ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªï¼Œå†æŠŠ<code>&lt;text&gt;æ™®é€šæ–‡æœ¬2&lt;/text&gt;</code>ç§»åŠ¨åˆ°strongèŠ‚ç‚¹é‡Œé¢ï¼›æœ‰åˆ™ç›´æ¥æŠŠæŠŠ<code>&lt;text&gt;æ™®é€šæ–‡æœ¬2&lt;/text&gt;</code>ç§»åŠ¨åˆ°strongèŠ‚ç‚¹é‡Œé¢</p>
</li>
</ul>
<p>ä¸Šé¢ä¸¾ä¾‹çš„åªæ˜¯ä¸€ç§ç®€å•çš„æƒ…å†µï¼Œä½†æ˜¯åœ¨å¯Œæ–‡æœ¬å‰ªè¾‘å™¨ä¸­ï¼Œç”¨æˆ·çš„æ“ä½œæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œ ç¨å¾®æ”¹å˜ä¸‹æ“ä½œæˆ‘ä»¬çš„é€»è¾‘å°±æœ‰å¯èƒ½è¦å‘ç”Ÿæ”¹å˜ï¼Œå¦‚å˜çº¢åŠ ç²—æ™®é€šæ–‡æœ¬4ï¼Œè¿™æ—¶æ˜¯ä¸æ˜¯è¿˜è¦å›è¿‡å¤´å»æ£€æµ‹å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å°±ä½¿éå†è¿‡ç¨‹éœ€è¦å›æº¯ï¼Œå¦‚æœç»“æ„å¾ˆå¤æ‚ï¼Œå¤„ç†è¿‡ç¨‹å°†ä¼šå˜å¾—éå¸¸ç¹çï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆéš¾ä¿è¯æˆ‘ä»¬çš„é€»è¾‘è¦†ç›–äº†ç”¨æˆ·æ‰€æœ‰çš„æ“ä½œå¯èƒ½æ€§ã€‚å› æ­¤ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦æ”¹å˜æ€è€ƒæ–¹å¼äº†ï¼Œæ˜¾ç„¶è¿™ç§åŸºäºç°æœ‰ç»“æ„çš„å˜æ¢æ“ä½œæ˜¯ä¸ç°å®çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½<strong>æ¶ˆé™¤å›æº¯</strong>çš„æ–¹æ³•ã€‚æ—¢ç„¶ åŸºäºç°æœ‰ç»“æ„çš„å˜æ¢è¡Œä¸é€šï¼Œé‚£å°±å¹²è„†é‡æ–°ç”Ÿæˆã€‚äºæ˜¯å¼•å…¥äº†ä¸€ç§æ‰å¹³åŒ–çš„ç»“æ„ï¼Œå®ƒèƒ½å¾ˆå¾ˆå¥½çš„æè¿°å†…å®¹çš„å†…å®¹å’Œæ ·å¼ã€‚æˆ‘æŠŠè¿™ç§ç»“æ„æˆä¸º <strong>å†…å®¹æ ‡è®°ç»“æ„</strong></p>
<h3 id="å†…å®¹æ ‡è®°æ¨¡å‹"><a href="#å†…å®¹æ ‡è®°æ¨¡å‹" class="headerlink" title="å†…å®¹æ ‡è®°æ¨¡å‹"></a>å†…å®¹æ ‡è®°æ¨¡å‹</h3><p>å†…å®¹æ ‡è®°èƒ½æŠŠä¸€ä¸ªblockä¸‹é¢çš„å†…å®¹æ‰å¹³åŒ–çš„æè¿°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„é‡Œé¢æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç»“æ„å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    content:<span class="string">&#x27;&#x27;</span>, <span class="comment">// å†…å®¹</span></span><br><span class="line">    mark:&#123;&#125;, <span class="comment">// æ ·å¼æ ‡è®°</span></span><br><span class="line">    selected:Bollean, <span class="comment">// æ˜¯å¦è¢«é€‰ä¸­</span></span><br><span class="line">    start:Bolleanï¼Œ <span class="comment">// æ˜¯å¦ä¸ºé€‰åŒºå¼€å§‹ä½ç‚¹</span></span><br><span class="line">    start:Bolleanï¼Œ <span class="comment">// æ˜¯å¦ä¸ºé€‰åŒºç»“æŸä½ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨å†…å®¹æ ‡è®°æ¨¡å‹é‡æ–°æè¿°ä¸Šé¢çš„é‚£æ®µå†…å®¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;<span class="attr">content</span>:<span class="string">&quot;æ™®é€šæ–‡æœ¬1&quot;</span>, <span class="attr">mark</span>:&#123;&#125;,- selected:<span class="literal">false</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">content</span>:<span class="string">&quot;æ™®é€šæ–‡æœ¬2&quot;</span>, <span class="attr">mark</span>:&#123;&#125;,<span class="attr">selected</span>:<span class="literal">true</span>, <span class="attr">start</span>:<span class="literal">true</span>, <span class="attr">end</span>:<span class="literal">true</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">content</span>:<span class="string">&quot;åŠ ç²—æ–‡æœ¬&quot;</span>, <span class="attr">mark</span>:&#123;<span class="attr">B</span>:<span class="literal">true</span>,<span class="attr">$FC</span>:<span class="string">&quot;red&quot;</span>&#125;, <span class="attr">selected</span>:<span class="literal">false</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">content</span>:<span class="string">&quot;æ–œä½“æ–‡æœ¬&quot;</span>, <span class="attr">mark</span>:&#123;<span class="attr">I</span>:<span class="literal">true</span>,<span class="attr">$FC</span>:<span class="string">&quot;red&quot;</span>&#125;, <span class="attr">selected</span>:<span class="literal">false</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">content</span>:<span class="string">&quot;æ™®é€šæ–‡æœ¬4&quot;</span>, <span class="attr">mark</span>:&#123;&#125;, <span class="attr">selected</span>:<span class="literal">false</span>&#125;]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>è¦å°†â€æ™®é€šæ–‡æœ¬2â€œå˜çº¢åŠ ç²—ï¼Œåªéœ€ç»™<code>selected:true</code>çš„æ ‡è®°çš„markè®¾ç½®ä¸º<code>mark:&#123;B:true,$FC:&quot;red&quot;&#125;</code>å°±å¯ä»¥äº†</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">transfer(blockVnode, range)</span><br><span class="line">    .toMarks(<span class="function">(<span class="params">marks</span>) =&gt;</span> &#123;</span><br><span class="line">      marks.forEach(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (ele.selected) &#123;</span><br><span class="line">            <span class="comment">// B ä»£è¡¨ bold $FC ä»£è¡¨ font-color</span></span><br><span class="line">          ele.mark[<span class="string">&#x27;B&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">          ele.mark[<span class="string">&#x27;$FC&#x27;</span>] = <span class="string">&#x27;red&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .toVNode(<span class="function">(<span class="params">chs</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> clonedVnode = blockVnode.clone()</span><br><span class="line">      clonedVnode.children = chs</span><br><span class="line">      patch(clonedVnode, blockVnode)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>transfer</code> çš„<code>toMarks</code>æ–¹æ³•èƒ½æŠŠä¸€æ®µvnodeçš„å†…å®¹è½¬åŒ–ä¸ºmarks,æˆ‘ä»¬å¯ä»¥åœ¨å›è°ƒä¸­å¯¹marksè¿›è¡Œä¿®æ”¹ï¼Œå†é€šè¿‡<code>toVNode</code>æ–¹æ³•è½¬åŒ–ä¸ºæ–°çš„vnodeï¼Œé€šè¿‡patchæ–¹æ³•å»æ›´æ–°domï¼Œè¿™æ ·å°±å®Œç¾çš„å®ç°äº†æ ·å¼çš„ä¿®æ”¹ã€‚è€Œvnodeå’Œmarksçš„ç›¸äº’è½¬åŒ–åˆ™ç”±å†…å®¹æ ‡è®°ç®—æ³•å®ç°.</p>
</blockquote>
<h3 id="å†…å®¹æ ‡è®°ç®—æ³•"><a href="#å†…å®¹æ ‡è®°ç®—æ³•" class="headerlink" title="å†…å®¹æ ‡è®°ç®—æ³•"></a>å†…å®¹æ ‡è®°ç®—æ³•</h3><blockquote>
<p>å†…å®¹æ ‡è®°ç®—æ³•ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ<strong>æ ‡è®°é˜¶æ®µ</strong>å’Œ<strong>ç”Ÿæˆé˜¶æ®µ</strong>ã€‚ä¸‹é¢å¤§è‡´è®²è§£ä¸‹æ€è·¯å’Œéƒ¨åˆ†ä»£ç ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/caiwuu/editor-pro/blob/master/src/core/model/transfer.js">å®Œæ•´ä»£ç å¯çœ‹æºç </a></p>
</blockquote>
<h4 id="1-æ ‡è®°é˜¶æ®µ"><a href="#1-æ ‡è®°é˜¶æ®µ" class="headerlink" title="1.æ ‡è®°é˜¶æ®µ"></a>1.æ ‡è®°é˜¶æ®µ</h4><p>æ ‡è®°é˜¶æ®µä»£ç éå¸¸ç®€å•ï¼Œå°±æ˜¯ç›´æ¥éå†æ•´é¢—vnodeæ ‘ï¼Œå¹¶ä¸”è®°å½•æ¯ä¸€å±‚çš„æ ·å¼ä¿¡æ¯ï¼Œæœ€åæ ‡è®°åˆ°å¶å­èŠ‚ç‚¹å³textèŠ‚ç‚¹ä¸Šé¢ï¼›åŒæ—¶æ ‡è®°é€‰åŒºçš„ä½ç½®å’Œé€‰ä¸­çŠ¶æ€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getContentMark</span>(<span class="params">vnode, range, inherit = &#123;&#125;, idx = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> marker = idx === <span class="number">0</span> ? &#123;&#125; : mark(vnode, inherit)</span><br><span class="line">  <span class="comment">// staticèŠ‚ç‚¹ä¸ä¼šæœ‰æ ‡è®°é‡ç»„çš„è¿‡ç¨‹ï¼Œdiffè¿‡ç¨‹ä¹Ÿå¤§å¤§èŠ‚çº¦æ€§èƒ½</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.editable === <span class="string">&#x27;off&#x27;</span> || (vnode.type === <span class="string">&#x27;block&#x27;</span> &amp;&amp; idx)) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      content: vnode,</span><br><span class="line">      <span class="keyword">static</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vnode.children.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> vnode.children.map(<span class="function">(<span class="params">i</span>) =&gt;</span> getContentMark(i, range, marker, ++idx)).flat()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vnode.tagName === <span class="string">&#x27;text&#x27;</span>) &#123;</span><br><span class="line">     <span class="keyword">if</span> (vnode === range.startVNode &amp;&amp; range.startVNode === range.endVNode) &#123;</span><br><span class="line">      <span class="keyword">const</span> res = []</span><br><span class="line">      vnode.context.slice(<span class="number">0</span>, range.startOffset) &amp;&amp;</span><br><span class="line">        res.push(&#123;</span><br><span class="line">          content: vnode.context.slice(<span class="number">0</span>, range.startOffset),</span><br><span class="line">          mark: &#123; ...marker &#125;,</span><br><span class="line">          selected: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      res.push(&#123;</span><br><span class="line">        content: vnode.context.slice(range.startOffset, range.endOffset),</span><br><span class="line">        mark: &#123; ...marker &#125;,</span><br><span class="line">        selected: <span class="literal">true</span>,</span><br><span class="line">        start: <span class="literal">true</span>,</span><br><span class="line">        end: <span class="literal">true</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      vnode.context.slice(range.endOffset) &amp;&amp;</span><br><span class="line">        res.push(&#123;</span><br><span class="line">          content: vnode.context.slice(range.endOffset),</span><br><span class="line">          mark: &#123; ...marker &#125;,</span><br><span class="line">          selected: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">         <span class="comment">// ä¸ºäº†æ–¹ä¾¿å±•ç¤ºçœç•¥è‹¥å¹²ä»£ç  ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// mark</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">mark</span>(<span class="params">vnode, inherit = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!vnode.children.length) <span class="keyword">return</span> &#123; ...inherit &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    B: vnode.tagName === <span class="string">&#x27;strong&#x27;</span> || inherit.B,</span><br><span class="line">    I: vnode.tagName === <span class="string">&#x27;em&#x27;</span> || inherit.I,</span><br><span class="line">    U: vnode.tagName === <span class="string">&#x27;u&#x27;</span> || inherit.U,</span><br><span class="line">    D: vnode.tagName === <span class="string">&#x27;del&#x27;</span> || inherit.D,</span><br><span class="line">    $FC: vnode.styles.get(<span class="string">&#x27;color&#x27;</span>) || inherit.$FC,</span><br><span class="line">    $BG: vnode.styles.get(<span class="string">&#x27;background&#x27;</span>) || inherit.$BG,</span><br><span class="line">    $FZ: vnode.styles.get(<span class="string">&#x27;font-size&#x27;</span>) || vnode.styles.get(<span class="string">&#x27;fontSize&#x27;</span>) || inherit.$FZ,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-ç”Ÿæˆé˜¶æ®µ"><a href="#2-ç”Ÿæˆé˜¶æ®µ" class="headerlink" title="2.ç”Ÿæˆé˜¶æ®µ"></a>2.ç”Ÿæˆé˜¶æ®µ</h4><p>ç”Ÿæˆé˜¶æ®µç¨å¾®æ¯”è¾ƒå¤æ‚ï¼Œå…¶ä¸­çš„ä»£ç å¯èƒ½ä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚è¿™é‡Œé€šè¿‡å›¾ç¤ºæ¥ç†è§£å¤§è‡´çš„æ€è·¯ã€‚</p>
<ol>
<li>åˆ†ç±»ï¼Œæ‰¾å‡ºå…·æœ‰ç›¸åŒå±æ€§çš„æœ€é•¿å­ä¸²ï¼š</li>
</ol>
<p><img src="https://fastly.jsdelivr.net/gh/caiwuu/image/image-20220330153226082.png" alt="image-20220330153226082"></p>
<ol start="2">
<li>ç”Ÿæˆï¼šæ ¹æ®åˆ†ç±»å¾—åˆ°groupæ•°æ®</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// group:</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        keys:[<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;$FC&#x27;</span>, <span class="string">&#x27;$BG&#x27;</span>, <span class="string">&#x27;$FZ&#x27;</span>],<span class="comment">// ç”¨äºä¸‹ä¸€æ­¥çš„keys</span></span><br><span class="line">        marksï¼š[...], <span class="comment">// å³è¯¥åˆ†ç±»ä¸‹çš„å†…å®¹æ ‡è®°</span></span><br><span class="line">        tags:[], <span class="comment">// å±äºåˆ†ç±»çš„åç§°ï¼Œkeysä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª,æ— åˆ™è¡¨ç¤ºä¸ºæ— æ ·å¼çš„æ–‡æœ¬</span></span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">    &#123;</span><br><span class="line">        keys:[<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;$BG&#x27;</span>, <span class="string">&#x27;$FZ&#x27;</span>],<span class="comment">// ç”¨äºä¸‹ä¸€æ­¥çš„keys</span></span><br><span class="line">        marksï¼š[...], <span class="comment">// å³è¯¥åˆ†ç±»ä¸‹çš„å†…å®¹æ ‡è®°</span></span><br><span class="line">        tags:[<span class="string">&#x27;$FC&#x27;</span>], <span class="comment">// å±äºåˆ†ç±»çš„åç§°ï¼Œkeysä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª,æ— åˆ™è¡¨ç¤ºä¸ºæ— æ ·å¼çš„æ–‡æœ¬</span></span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">    &#123;</span><br><span class="line">        keys:[<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;$BG&#x27;</span>],<span class="comment">// ç”¨äºä¸‹ä¸€æ­¥çš„keys</span></span><br><span class="line">        marksï¼š[...], <span class="comment">// å³è¯¥åˆ†ç±»ä¸‹çš„å†…å®¹æ ‡è®°</span></span><br><span class="line">        tags:[<span class="string">&#x27;$FZ&#x27;</span>], <span class="comment">// å±äºåˆ†ç±»çš„åç§°ï¼Œkeysä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª,æ— åˆ™è¡¨ç¤ºä¸ºæ— æ ·å¼çš„æ–‡æœ¬</span></span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">     &#123;</span><br><span class="line">        keys:[<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;$BG&#x27;</span>],<span class="comment">// ç”¨äºä¸‹ä¸€æ­¥çš„keys</span></span><br><span class="line">        marksï¼š[...], <span class="comment">// å³è¯¥åˆ†ç±»ä¸‹çš„å†…å®¹æ ‡è®°</span></span><br><span class="line">        tags:[], <span class="comment">// å±äºåˆ†ç±»çš„åç§°ï¼Œkeysä¸­çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ª,æ— åˆ™è¡¨ç¤ºä¸ºæ— æ ·å¼çš„æ–‡æœ¬</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯ä¸ªgroupä¸­marksé•¿åº¦å¤§äº1çš„ä¹Ÿæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç›´åˆ°ä¸èƒ½å†åˆ†ä¸ºæ­¢ï¼š</p>
<p><img src="https://fastly.jsdelivr.net/gh/caiwuu/image/image-20220330153404299.png" alt="image-20220330153404299"></p>
<ol start="3">
<li>ç”Ÿæˆjsonï¼ˆvnodeçš„jsonè¡¨ç¤ºå½¢å¼ï¼‰</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        tagNameï¼š<span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">        attrs:&#123;&#125;,</span><br><span class="line">        children:<span class="string">&#x27;text&#x27;</span></span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">    &#123;</span><br><span class="line">        tagNameï¼š<span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">        attrs:&#123;</span><br><span class="line">        	style:<span class="string">&#x27;color:red&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        children:[</span><br><span class="line">        	...</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">    ....</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä½†æ˜¯æºç ä¸­å¹¶ä¸æ˜¯å…¨éƒ¨åˆ†ç±»å®Œæ‰å»ç”Ÿæˆjsonçš„ï¼Œè€Œæ˜¯è¾¹ç”Ÿæˆè¾¹åˆ†ç±»è§£æçš„ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹</p>
</blockquote>
<p>4.æœ€åç”Ÿæˆvnode</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">json2VNode</span>(<span class="params">list, range</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> list.map(<span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = createElement(</span><br><span class="line">      ele.tagName,</span><br><span class="line">      &#123; ...ele.attrs &#125;,</span><br><span class="line">      <span class="keyword">typeof</span> ele.children === <span class="string">&#x27;string&#x27;</span> ? ele.children : json2VNode(ele.children, range)</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (ele.startOffset !== <span class="literal">undefined</span>) range.setStart(res, ele.startOffset)</span><br><span class="line">    <span class="keyword">if</span> (ele.endOffset !== <span class="literal">undefined</span>) range.setEnd(res, ele.endOffset)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”±æ­¤å¯è§ï¼Œé€šè¿‡è¿™å¥—ç®—æ³•ç”Ÿæˆçš„èŠ‚ç‚¹æ˜¯æœ€ä¼˜çš„ï¼Œèƒ½è¾¾åˆ°æ ‡ç­¾å»è„çš„ç›®çš„ï¼Œèƒ½é¿å…æ ‡ç­¾çš„æ— é™åµŒå¥—ã€‚</p>
</blockquote>
<p>æœ€åç”¨ä¸€å¹…å›¾æ¥æ€»ç»“ä¸‹æœ¬èŠ‚å†…å®¹ï¼š</p>
<p><img src="https://fastly.jsdelivr.net/gh/caiwuu/image/image-20220330160457011.png" alt="image-20220330160457011"></p>
</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>Author:</span>
        <span> Cai Wu </span>
      </p>
       
      <p class="copyright-item" style="text-overflow: ellipsis; overflow: hidden">
        <span>Permalink:</span>
        <span><a href="https://caiwuu.github.io/posts/c753095b.html"> https://caiwuu.github.io/posts/c753095b.html </a></span>
      </p>
        
    </section>
    
    <section class="post-tags">
      <div>
        <span>Tag(s):</span>
        <span class="tag">
          
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">back</a>
        <span>Â· </span>
        <a href="/">home</a>
      </div>
    </section>
    <section class="post-nav" style="height: 72px">
      
      <a class="prev" rel="next" href="/posts/4563e85b.html"> æ–°ä¸€ä»£å¯Œæ–‡æœ¬ç¼–è¾‘å™¨è®¾è®¡ï¼ˆäºŒï¼‰ </a>
       
      <a class="next" rel="prev" href="/posts/4a17b156.html"> GitHub Actions </a>
      
    </section>
    <div id="vcomments"></div>
    <!-- id å°†ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ -->
    <script>
      const viewer = new Viewer(document.getElementById('artcle-container'), {
        inline: false,
        // viewed() {
        //   // viewer.zoomTo(0.8)
        // },
      })
      new Valine({
        el: '#vcomments',
        appId: 'WMcVmY3mpwsbkLkKENagoOts-gzGzoHsz',
        appKey: 'eE10SdKfvwoU6o1FKHRS3JuF',
        meta: ['nick'],
        avatar: 'robohash',
        visitor: true, // é˜…è¯»é‡ç»Ÿè®¡
        recordIP: true,
      })
    </script>
  </article>
</div>

        </div>
        <footer id="footer" class="footer">
  <div class="copyright">
    <span>Â© Cai Wu | 2020</span>
  </div>
</footer>

    </div>
</body>
</html>
